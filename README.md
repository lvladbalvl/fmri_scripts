# Скрипты для обработки и анализа фМРТ
Некоторые общие особенности для большинства скриптов:
1) Первым аргументом передается путь к папки с сессиями. Внутри скрипта переменная может по-разному называться: pathn, sessDir и т.п., но означает все время одно и то же
2) В большинство скриптов передается строковая переменная (в одинарных кавычках) с префиксом папки по конкретной последовательности (фМРТ, анатомия, филд мапинг). Например 'REST_FEAR_TR3000_' - возьмет папку, название которой начинается с такого префикса. Папка такая должна быть только одна для каждого испытуемого. В некоторых скриптах реализован перебор нескольких вариантов папок с анатомией. В таком случае вместо строковой переменной передается массив строковых переменных (тип cell) в порядке приоритета
3) Все входные параметры, касающиеся путей к папкам или файлам, должны быть абсолютными. В некоторых скриптах фигурирует парамет mask. Это - путь к файлу с маской желудочков для регрессии.
4) Большинство скриптов действуют по следующему принципу: проходят по всем папкам с испытуемыми, проверяют наличие нужных папок и файлов, параллельно записывая в переменные пути к нужным файлам. В некоторых идет чтение этих файлов и анализ, а в некоторых пути передаются в структуру matlabbatch, с которой потом запускается spm_jobman. Логично предположить, что правильно было бы реализовать процедуру поиска нужных файлов отдельным скриптом. Чтобы уменьшить copy past code. Возникает вопрос: как же передать ему то, где и какие файлы нужно искать. Лучше всего на мой взгляд передавать массив структур с полем dir - с префиксом директории и с полем file_prefix - cell с перечислением префиксов файлов. А он бы выдавал тоже массив структур с теми же полями и еще с полем files. Но у меня так и не нашлось времени написать такую функцию.
5) Отдельно про структуру matlabbatch:
  a) структура эта представляет собой пайплайн обработки, в которой сколько-то полей не заданы (могут быть и все заданы). Создается она средствами SPM. Сначала формируется в GUI SPM нужный пайплайн - потом жмется save batch and script. Он сохраняет два файла. Один с тем названием, который вы укажете, второй с тем же названием с приставкой job. Во втором и будет хранится эта структура с незаданными полями отмеченными как '<UNDEFINED>'. 
  б) Передавать незаданные поля в эту структуру можно двумя способами. Первый: Сначала загружаем ее в оперативку внутри своего скрипта. Для этого просто вызываем ее по названию файла. some_fmri_pipeline_job; - например так. Записываем нужные поля туда в своем скрипте и передаваем в spm_jobman эту структуру как параметр. Второй: передаем в spm_jobman путь к этому файлу (абсолютный) и cell массив (inputs у меня) где в правильно порядке заданы необходимые поля! Правильный порядок подскажет первый из созданных spm файлов (который без приставки job). Можно и комбинированный подход. Часть полей задавать вручную, часть через inputs. Некоторые поля нельзя оставить undefined при создании пайплайна - например путь к rp*.txt файлу с регрессорами движений. Его только через структуру matlabbatch можно задать

# Немного про рисунки
Рисунки я делал в трех программах:
  1) Все что касается активаций фМРТ - в xjview. В основном это можно сделать тремя способами:
    а) в трех проекциях, как он по умолчанию и отображает. можно выбирать то на чем он будет отображать
    б) проекция на трехмерную голову/ мозг / вещество. Кнопка render
    в) мультисрез. То же отдельная кнопка. Можно во всплывающем окне задавать диапазон срезов и шаг
  2) Оверлап поражений - в mricron
  3) Матрицы корреляций. Простыми средствами Matlab. У меня есть скрипт tosymmetric - который переводит вектор длины M (кол-во пар масок) в квадратную симметричную матрицу NxN (кол-во масок на кол-во масок). После этого ее можно отобразить через ф-цию imagesc например. 
  
# Про маски
Маски я делаю в WFU Pickatlas. Там все очень просто. Выбираете маску. Ее можно сплитить на полушария, падить (dilate) - чтобы немного расширить ее границы и использовать всякую булеву логику, чтобы создать из масок конгламераты (там тоже все просто - но я ниразу не пользовался). WFU PickAtlas конфликтует с spm и xjview. Поэтому нужно добавлять/удалять из path каждый раз
